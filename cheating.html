<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Проверка списывания</title>
    <style>
        th {
            font-weight: normal;
        }

        p.vt {
            transform: rotate(-60deg);
            white-space: nowrap;
            width: 6px;
            height: 120px;
            position: relative;
            left: 3em;
            top: 80px;
            color: black;
        }

        .nm {
            color: black;
            white-space: nowrap;
            border: none;
            text-align: right;
            padding: 0 3px;
        }

        .nmh {
            width: 10em;
            max-width: 10em;
        }

        table {
            border-collapse: collapse;
            margin: 20px;
        }

        td {
            border: 1px solid black;
            width: 24px;
            height: 24px;
            max-width: 24px;
            max-height: 24px;
            line-height: 24px;
            padding: 0;
            text-align: center;
            vertical-align: middle;
        }

        td:hover {
            border: 2px solid red;
            box-shadow: inset 0 0 10px 5px rgba(255, 0, 0, 0.5);
        }

        h1, h2 {
            margin: 2em auto 1em auto;
            text-align: center;
        }
    </style>
</head>
<body>
<div>
    <input type="text" id="reportList" style="width: 60%;">
    <button id="reportGen">Report</button>
</div>

<div id="report">
</div>
<script>
    const URL_PREFIX = '';
    let root = null;
    let reportList = null;
    let reportGenButton = null;
    const CONTESTS_PARM = 'contests';
    const MEAN = '__MEAN__';

    function loadScript(src, integrity) {
        return new Promise(function (resolve, reject) {
            const script = document.createElement('script');
            script.src = src;
            if (integrity) {
                script.crossOrigin = 'anonymous';
                script.integrity = integrity;
            }
            script.onload = script.onreadystatechange = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
        });
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function updateURLParameter(param, value) {
        let url = window.location.href;
        const re = new RegExp("([?&])" + param + "=.*?(&|#|$)(.*)", "i");
        let hash = '';
        if (url.includes('#')) {
            hash = url.replace(/.*#/, '#');
            url = url.replace(/#.*/, '');
        }
        const separator = url.includes('?') ? "&" : "?";
        if (url.match(re)) {
            if (typeof value !== 'undefined' && value !== null && value !== '') {
                // if parameter exists already, update it
                url = url.replace(re, '$1' + param + "=" + encodeURIComponent(value) + '$2$3');
            } else {
                const hashOrEnd = url.indexOf('#') === -1 ? '$2$3' : '#';
                url = url.replace(re, '$1' + hashOrEnd + '$3');
            }
        } else if (typeof value !== 'undefined' && value !== null && value !== '') {
            // if URL doesn't have it already, add parameter to URL
            url = url + separator + param + "=" + encodeURIComponent(value);
        }
        window.history.replaceState({}, '', url + hash); // replace the URL in the browser address bar without reloading
    }

    async function fetchJsonFromUrl(url) {
        // return JSON.parse(`{"students": {"28201": "Аболяев  Виктор", "28202": "Абросимов  Андрей", "28203": "Ахметова  Алина", "28204": "Бията  Елизавета", "28205": "Богдановский  Михаил", "28206": "Вахрушев  Александр", "28207": "Габышев  Матвей", "28208": "Губарев  Ярослав", "28209": "Демченко  Максим", "28210": "Дмитриенко  Лада", "28211": "Ероховец  Иван", "28212": "Каверин  Александр", "28213": "Ключарева  Вероника", "28214": "Кожевников  Илья", "28215": "Крупенин  Владислав", "28216": "Малеванный  Пётр", "28217": "Рубцов  Фёдор", "28218": "Сергеев  Вениамин", "28219": "Смирнов  Григорий", "28220": "Соколов  Матвей", "28221": "Сухов  Алексей", "28222": "Умнов  Максим", "28223": "Чирков  Тимур", "28224": "Шагабутдинов  Ильдар", "28225": "Таратенко Давид"}, "problems": {"A": "Кубик", "B": "Катер", "C": "Бургеры", "D": "Дни недели", "E": "Поклейка обоев", "F": "Стадион", "G": "Первый-второй"}, "scores": {"A": [[28201, 28202, 0.4848], [28201, 28203, 0.1516], [28201, 28204, 0.5163], [28201, 28205, 0.4899], [28201, 28206, 0.5555], [28201, 28207, 0.485], [28201, 28208, 0.4043], [28201, 28209, 0.1458], [28201, 28210, 0.1647], [28201, 28211, 0.1647], [28201, 28212, 0.3922], [28201, 28213, 0.4386], [28201, 28214, 0.2471], [28201, 28215, 0.4848], [28201, 28216, 0.1023], [28201, 28217, 0.6602], [28201, 28218, 0.2948], [28201, 28219, 0.5555], [28201, 28220, 0.1458], [28201, 28221, 0.5238], [28201, 28222, 0.1975], [28201, 28223, 0.1469], [28201, 28224, 0.1367], [28201, 28225, 0.1458], [28202, 28203, 0.164], [28202, 28204, 0.3555], [28202, 28205, 0.338], [28202, 28206, 0.6286], [28202, 28207, 0.5547], [28202, 28208, 0.8582], [28202, 28209, 0.1583], [28202, 28210, 0.3346], [28202, 28211, 0.3346], [28202, 28212, 0.2994], [28202, 28213, 0.2948], [28202, 28214, 0.1204], [28202, 28215, 1.0], [28202, 28216, 0.1342], [28202, 28217, 0.7358], [28202, 28218, 0.2401], [28202, 28219, 0.6286], [28202, 28220, 0.1583], [28202, 28221, 0.2149], [28202, 28222, 0.2097], [28202, 28223, 0.1309], [28202, 28224, 0.164], [28202, 28225, 0.1583], [28203, 28204, 0.1099], [28203, 28205, 0.093], [28203, 28206, 0.2401], [28203, 28207, 0.2401], [28203, 28208, 0.1697], [28203, 28209, 0.9253], [28203, 28210, 0.5523], [28203, 28211, 0.5523], [28203, 28212, 0.1975], [28203, 28213, 0.1469], [28203, 28214, 0.0625], [28203, 28215, 0.164], [28203, 28216, 0.2603], [28203, 28217, 0.2175], [28203, 28218, 0.2192], [28203, 28219, 0.2401], [28203, 28220, 0.9253], [28203, 28221, 0.1714], [28203, 28222, 0.8258], [28203, 28223, 0.7629], [28203, 28224, 0.8574], [28203, 28225, 0.9253], [28204, 28205, 0.522], [28204, 28206, 0.2994], [28204, 28207, 0.2575], [28204, 28208, 0.2958], [28204, 28209, 0.105], [28204, 28210, 0.1345], [28204, 28211, 0.1345], [28204, 28212, 0.2382], [28204, 28213, 0.3392], [28204, 28214, 0.203], [28204, 28215, 0.3555], [28204, 28216, 0.0847], [28204, 28217, 0.3674], [28204, 28218, 0.1865], [28204, 28219, 0.2994], [28204, 28220, 0.105], [28204, 28221, 0.2334], [28204, 28222, 0.1445], [28204, 28223, 0.1066], [28204, 28224, 0.0988], [28204, 28225, 0.105], [28205, 28206, 0.2836], [28205, 28207, 0.2438], [28205, 28208, 0.3216], [28205, 28209, 0.0988], [28205, 28210, 0.1395], [28205, 28211, 0.1395], [28205, 28212, 0.2084], [28205, 28213, 0.3219], [28205, 28214, 0.177], [28205, 28215, 0.338], [28205, 28216, 0.0885], [28205, 28217, 0.3483], [28205, 28218, 0.1762], [28205, 28219, 0.2836], [28205, 28220, 0.0988], [28205, 28221, 0.2391], [28205, 28222, 0.1233], [28205, 28223, 0.0903], [28205, 28224, 0.093], [28205, 28225, 0.0988], [28206, 28207, 0.8858], [28206, 28208, 0.5253], [28206, 28209, 0.2568], [28206, 28210, 0.1915], [28206, 28211, 0.1915], [28206, 28212, 0.488], [28206, 28213, 0.3811], [28206, 28214, 0.1402], [28206, 28215, 0.6286], [28206, 28216, 0.1296], [28206, 28217, 0.8618], [28206, 28218, 0.3436], [28206, 28219, 1.0], [28206, 28220, 0.2568], [28206, 28221, 0.3331], [28206, 28222, 0.2109], [28206, 28223, 0.1911], [28206, 28224, 0.2638], [28206, 28225, 0.2568], [28207, 28208, 0.4617], [28207, 28209, 0.2568], [28207, 28210, 0.1743], [28207, 28211, 0.1743], [28207, 28212, 0.422], [28207, 28213, 0.3541], [28207, 28214, 0.127], [28207, 28215, 0.5547], [28207, 28216, 0.1296], [28207, 28217, 0.762], [28207, 28218, 0.2909], [28207, 28219, 0.8858], [28207, 28220, 0.2568], [28207, 28221, 0.2819], [28207, 28222, 0.2109], [28207, 28223, 0.1727], [28207, 28224, 0.2638], [28207, 28225, 0.2568], [28208, 28209, 0.164], [28208, 28210, 0.3405], [28208, 28211, 0.3405], [28208, 28212, 0.2631], [28208, 28213, 0.2603], [28208, 28214, 0.0942], [28208, 28215, 0.8582], [28208, 28216, 0.1388], [28208, 28217, 0.6202], [28208, 28218, 0.2269], [28208, 28219, 0.5253], [28208, 28220, 0.164], [28208, 28221, 0.1867], [28208, 28222, 0.2157], [28208, 28223, 0.1361], [28208, 28224, 0.1697], [28208, 28225, 0.164], [28209, 28210, 0.5461], [28209, 28211, 0.5461], [28209, 28212, 0.2113], [28209, 28213, 0.1566], [28209, 28214, 0.0668], [28209, 28215, 0.1583], [28209, 28216, 0.2314], [28209, 28217, 0.2109], [28209, 28218, 0.2352], [28209, 28219, 0.2568], [28209, 28220, 1.0], [28209, 28221, 0.1648], [28209, 28222, 0.8227], [28209, 28223, 0.6988], [28209, 28224, 0.9253], [28209, 28225, 1.0], [28210, 28211, 1.0], [28210, 28212, 0.1583], [28210, 28213, 0.1455], [28210, 28214, 0.0749], [28210, 28215, 0.3346], [28210, 28216, 0.3164], [28210, 28217, 0.229], [28210, 28218, 0.1912], [28210, 28219, 0.1915], [28210, 28220, 0.5461], [28210, 28221, 0.0983], [28210, 28222, 0.6737], [28210, 28223, 0.4166], [28210, 28224, 0.5094], [28210, 28225, 0.5461], [28211, 28212, 0.1583], [28211, 28213, 0.1455], [28211, 28214, 0.0749], [28211, 28215, 0.3346], [28211, 28216, 0.3164], [28211, 28217, 0.229], [28211, 28218, 0.1912], [28211, 28219, 0.1915], [28211, 28220, 0.5461], [28211, 28221, 0.0983], [28211, 28222, 0.6737], [28211, 28223, 0.4166], [28211, 28224, 0.5094], [28211, 28225, 0.5461], [28212, 28213, 0.3286], [28212, 28214, 0.2422], [28212, 28215, 0.2994], [28212, 28216, 0.1177], [28212, 28217, 0.4156], [28212, 28218, 0.6292], [28212, 28219, 0.488], [28212, 28220, 0.2113], [28212, 28221, 0.3611], [28212, 28222, 0.1727], [28212, 28223, 0.2323], [28212, 28224, 0.2401], [28212, 28225, 0.2113], [28213, 28214, 0.2603], [28213, 28215, 0.2948], [28213, 28216, 0.0815], [28213, 28217, 0.3501], [28213, 28218, 0.2422], [28213, 28219, 0.3811], [28213, 28220, 0.1566], [28213, 28221, 0.2351], [28213, 28222, 0.1423], [28213, 28223, 0.1423], [28213, 28224, 0.1469], [28213, 28225, 0.1566], [28214, 28215, 0.1204], [28214, 28216, 0.0437], [28214, 28217, 0.1413], [28214, 28218, 0.2234], [28214, 28219, 0.1402], [28214, 28220, 0.0668], [28214, 28221, 0.3611], [28214, 28222, 0.0783], [28214, 28223, 0.0689], [28214, 28224, 0.0625], [28214, 28225, 0.0668], [28215, 28216, 0.1342], [28215, 28217, 0.7358], [28215, 28218, 0.2401], [28215, 28219, 0.6286], [28215, 28220, 0.1583], [28215, 28221, 0.2149], [28215, 28222, 0.2097], [28215, 28223, 0.1309], [28215, 28224, 0.164], [28215, 28225, 0.1583], [28216, 28217, 0.1434], [28216, 28218, 0.1402], [28216, 28219, 0.1296], [28216, 28220, 0.2314], [28216, 28221, 0.0644], [28216, 28222, 0.2305], [28216, 28223, 0.2305], [28216, 28224, 0.2379], [28216, 28225, 0.2314], [28217, 28218, 0.3396], [28217, 28219, 0.8618], [28217, 28220, 0.2109], [28217, 28221, 0.3038], [28217, 28222, 0.2775], [28217, 28223, 0.1732], [28217, 28224, 0.2175], [28217, 28225, 0.2109], [28218, 28219, 0.3436], [28218, 28220, 0.2352], [28218, 28221, 0.3411], [28218, 28222, 0.2116], [28218, 28223, 0.2585], [28218, 28224, 0.2192], [28218, 28225, 0.2352], [28219, 28220, 0.2568], [28219, 28221, 0.3331], [28219, 28222, 0.2109], [28219, 28223, 0.1911], [28219, 28224, 0.2638], [28219, 28225, 0.2568], [28220, 28221, 0.1648], [28220, 28222, 0.8227], [28220, 28223, 0.6988], [28220, 28224, 0.9253], [28220, 28225, 1.0], [28221, 28222, 0.1484], [28221, 28223, 0.2044], [28221, 28224, 0.1537], [28221, 28225, 0.1648], [28222, 28223, 0.6243], [28222, 28224, 0.7629], [28222, 28225, 0.8227], [28223, 28224, 0.648], [28223, 28225, 0.6988], [28224, 28225, 0.9253]], "B": [[28201, 28202, 0.2563], [28201, 28203, 0.8187], [28201, 28204, 0.8187], [28201, 28206, 0.6767], [28201, 28207, 0.5482], [28201, 28208, 0.683], [28201, 28209, 0.2318], [28201, 28210, 0.6023], [28201, 28211, 0.8187], [28201, 28212, 0.59], [28201, 28213, 0.3768], [28201, 28214, 0.4913], [28201, 28215, 0.5482], [28201, 28216, 0.6767], [28201, 28218, 1.0], [28201, 28219, 0.3122], [28201, 28220, 0.6023], [28201, 28221, 0.3387], [28201, 28222, 0.59], [28201, 28223, 0.7435], [28201, 28224, 0.8187], [28201, 28225, 0.3682], [28202, 28203, 0.2852], [28202, 28204, 0.3164], [28202, 28206, 0.3011], [28202, 28207, 0.2721], [28202, 28208, 0.3088], [28202, 28209, 0.218], [28202, 28210, 0.2375], [28202, 28211, 0.3164], [28202, 28212, 0.2978], [28202, 28213, 0.3893], [28202, 28214, 0.3011], [28202, 28215, 0.3323], [28202, 28216, 0.3011], [28202, 28218, 0.2563], [28202, 28219, 0.505], [28202, 28220, 0.2375], [28202, 28221, 0.5834], [28202, 28222, 0.3603], [28202, 28223, 0.2643], [28202, 28224, 0.3164], [28202, 28225, 0.6737], [28203, 28204, 0.8187], [28203, 28206, 0.5482], [28203, 28207, 0.6767], [28203, 28208, 0.5563], [28203, 28209, 0.2057], [28203, 28210, 0.7435], [28203, 28211, 0.8187], [28203, 28212, 0.59], [28203, 28213, 0.4627], [28203, 28214, 0.3909], [28203, 28215, 0.5482], [28203, 28216, 0.5482], [28203, 28218, 0.8187], [28203, 28219, 0.2798], [28203, 28220, 0.7435], [28203, 28221, 0.3387], [28203, 28222, 0.59], [28203, 28223, 0.9081], [28203, 28224, 0.8187], [28203, 28225, 0.2948], [28204, 28206, 0.5482], [28204, 28207, 0.5482], [28204, 28208, 0.5563], [28204, 28209, 0.2057], [28204, 28210, 0.6701], [28204, 28211, 1.0], [28204, 28212, 0.6528], [28204, 28213, 0.3768], [28204, 28214, 0.4913], [28204, 28215, 0.6767], [28204, 28216, 0.5482], [28204, 28218, 0.8187], [28204, 28219, 0.2798], [28204, 28220, 0.6701], [28204, 28221, 0.3387], [28204, 28222, 0.6528], [28204, 28223, 0.7435], [28204, 28224, 1.0], [28204, 28225, 0.3682], [28206, 28207, 0.6891], [28206, 28208, 0.9158], [28206, 28209, 0.1975], [28206, 28210, 0.4481], [28206, 28211, 0.5482], [28206, 28212, 0.446], [28206, 28213, 0.4784], [28206, 28214, 0.7588], [28206, 28215, 0.8337], [28206, 28216, 1.0], [28206, 28218, 0.6767], [28206, 28219, 0.3639], [28206, 28220, 0.4481], [28206, 28221, 0.4345], [28206, 28222, 0.4009], [28206, 28223, 0.5], [28206, 28224, 0.5482], [28206, 28225, 0.4707], [28207, 28208, 0.6311], [28207, 28209, 0.155], [28207, 28210, 0.5], [28207, 28211, 0.5482], [28207, 28212, 0.4009], [28207, 28213, 0.6305], [28207, 28214, 0.5085], [28207, 28215, 0.6891], [28207, 28216, 0.6891], [28207, 28218, 0.5482], [28207, 28219, 0.3289], [28207, 28220, 0.5], [28207, 28221, 0.2882], [28207, 28222, 0.4009], [28207, 28223, 0.6172], [28207, 28224, 0.5482], [28207, 28225, 0.3122], [28208, 28209, 0.2052], [28208, 28210, 0.457], [28208, 28211, 0.5563], [28208, 28212, 0.5029], [28208, 28213, 0.486], [28208, 28214, 0.695], [28208, 28215, 0.7636], [28208, 28216, 0.9158], [28208, 28218, 0.683], [28208, 28219, 0.337], [28208, 28220, 0.457], [28208, 28221, 0.4017], [28208, 28222, 0.4544], [28208, 28223, 0.5085], [28208, 28224, 0.5563], [28208, 28225, 0.4345], [28209, 28210, 0.1678], [28209, 28211, 0.2057], [28209, 28212, 0.1975], [28209, 28213, 0.2512], [28209, 28214, 0.155], [28209, 28215, 0.1753], [28209, 28216, 0.1975], [28209, 28218, 0.2318], [28209, 28219, 0.2342], [28209, 28220, 0.1678], [28209, 28221, 0.1839], [28209, 28222, 0.1975], [28209, 28223, 0.2401], [28209, 28224, 0.2057], [28209, 28225, 0.177], [28210, 28211, 0.6701], [28210, 28212, 0.5973], [28210, 28213, 0.3473], [28210, 28214, 0.4004], [28210, 28215, 0.5], [28210, 28216, 0.4481], [28210, 28218, 0.6023], [28210, 28219, 0.2583], [28210, 28220, 1.0], [28210, 28221, 0.3473], [28210, 28222, 0.4865], [28210, 28223, 0.6767], [28210, 28224, 0.6701], [28210, 28225, 0.3036], [28211, 28212, 0.6528], [28211, 28213, 0.3768], [28211, 28214, 0.4913], [28211, 28215, 0.6767], [28211, 28216, 0.5482], [28211, 28218, 0.8187], [28211, 28219, 0.2798], [28211, 28220, 0.6701], [28211, 28221, 0.3387], [28211, 28222, 0.6528], [28211, 28223, 0.7435], [28211, 28224, 1.0], [28211, 28225, 0.3682], [28212, 28213, 0.3164], [28212, 28214, 0.3593], [28212, 28215, 0.4948], [28212, 28216, 0.446], [28212, 28218, 0.59], [28212, 28219, 0.2375], [28212, 28220, 0.5973], [28212, 28221, 0.5126], [28212, 28222, 0.8435], [28212, 28223, 0.6593], [28212, 28224, 0.6528], [28212, 28225, 0.4177], [28213, 28214, 0.3936], [28213, 28215, 0.4784], [28213, 28216, 0.4784], [28213, 28218, 0.3768], [28213, 28219, 0.4623], [28213, 28220, 0.3473], [28213, 28221, 0.3811], [28213, 28222, 0.3501], [28213, 28223, 0.4707], [28213, 28224, 0.3768], [28213, 28225, 0.4096], [28214, 28215, 0.7588], [28214, 28216, 0.7588], [28214, 28218, 0.4913], [28214, 28219, 0.3289], [28214, 28220, 0.4004], [28214, 28221, 0.3557], [28214, 28222, 0.321], [28214, 28223, 0.4004], [28214, 28224, 0.4913], [28214, 28225, 0.3853], [28215, 28216, 0.8337], [28215, 28218, 0.5482], [28215, 28219, 0.3289], [28215, 28220, 0.5], [28215, 28221, 0.3936], [28215, 28222, 0.446], [28215, 28223, 0.5], [28215, 28224, 0.6767], [28215, 28225, 0.4264], [28216, 28218, 0.6767], [28216, 28219, 0.3639], [28216, 28220, 0.4481], [28216, 28221, 0.4345], [28216, 28222, 0.4009], [28216, 28223, 0.5], [28216, 28224, 0.5482], [28216, 28225, 0.4707], [28218, 28219, 0.3122], [28218, 28220, 0.6023], [28218, 28221, 0.3387], [28218, 28222, 0.59], [28218, 28223, 0.7435], [28218, 28224, 0.8187], [28218, 28225, 0.3682], [28219, 28220, 0.2583], [28219, 28221, 0.4242], [28219, 28222, 0.2932], [28219, 28223, 0.2882], [28219, 28224, 0.2798], [28219, 28225, 0.4962], [28220, 28221, 0.3473], [28220, 28222, 0.4865], [28220, 28223, 0.6767], [28220, 28224, 0.6701], [28220, 28225, 0.3036], [28221, 28222, 0.4256], [28221, 28223, 0.3122], [28221, 28224, 0.3387], [28221, 28225, 0.683], [28222, 28223, 0.6593], [28222, 28224, 0.6528], [28222, 28225, 0.5054], [28223, 28224, 0.7435], [28223, 28225, 0.3036], [28224, 28225, 0.3682]], "C": [[28201, 28202, 0.3244], [28201, 28203, 0.9158], [28201, 28204, 0.9176], [28201, 28205, 0.554], [28201, 28206, 0.3323], [28201, 28207, 0.5791], [28201, 28208, 0.4256], [28201, 28209, 0.2307], [28201, 28210, 0.9192], [28201, 28211, 0.9158], [28201, 28212, 0.4441], [28201, 28213, 0.3527], [28201, 28214, 0.2847], [28201, 28215, 0.4017], [28201, 28217, 0.3501], [28201, 28218, 0.4521], [28201, 28219, 0.4177], [28201, 28220, 0.4784], [28201, 28221, 0.5246], [28201, 28222, 0.5107], [28201, 28223, 0.46], [28201, 28224, 0.5183], [28201, 28225, 0.5246], [28202, 28203, 0.3501], [28202, 28204, 0.3244], [28202, 28205, 0.5461], [28202, 28206, 0.4823], [28202, 28207, 0.5675], [28202, 28208, 0.4312], [28202, 28209, 0.2046], [28202, 28210, 0.3011], [28202, 28211, 0.3501], [28202, 28212, 0.3401], [28202, 28213, 0.3962], [28202, 28214, 0.3546], [28202, 28215, 0.4096], [28202, 28217, 0.5523], [28202, 28218, 0.3164], [28202, 28219, 0.3885], [28202, 28220, 0.2773], [28202, 28221, 0.3944], [28202, 28222, 0.3203], [28202, 28223, 0.4242], [28202, 28224, 0.2978], [28202, 28225, 0.3944], [28203, 28204, 0.9158], [28203, 28205, 0.4979], [28203, 28206, 0.3244], [28203, 28207, 0.6311], [28203, 28208, 0.4177], [28203, 28209, 0.2499], [28203, 28210, 0.8403], [28203, 28211, 0.8337], [28203, 28212, 0.4358], [28203, 28213, 0.3125], [28203, 28214, 0.2773], [28203, 28215, 0.3557], [28203, 28217, 0.3784], [28203, 28218, 0.4902], [28203, 28219, 0.4521], [28203, 28220, 0.4707], [28203, 28221, 0.5718], [28203, 28222, 0.5029], [28203, 28223, 0.4979], [28203, 28224, 0.5107], [28203, 28225, 0.5718], [28204, 28205, 0.5054], [28204, 28206, 0.3011], [28204, 28207, 0.5791], [28204, 28208, 0.4676], [28204, 28209, 0.2307], [28204, 28210, 0.8435], [28204, 28211, 0.8371], [28204, 28212, 0.4013], [28204, 28213, 0.3203], [28204, 28214, 0.2585], [28204, 28215, 0.3639], [28204, 28217, 0.3501], [28204, 28218, 0.4521], [28204, 28219, 0.4177], [28204, 28220, 0.4784], [28204, 28221, 0.5246], [28204, 28222, 0.4627], [28204, 28223, 0.46], [28204, 28224, 0.5183], [28204, 28225, 0.5246], [28205, 28206, 0.5523], [28205, 28207, 0.6618], [28205, 28208, 0.6355], [28205, 28209, 0.2622], [28205, 28210, 0.5126], [28205, 28211, 0.4979], [28205, 28212, 0.4333], [28205, 28213, 0.4166], [28205, 28214, 0.4369], [28205, 28215, 0.4719], [28205, 28217, 0.5398], [28205, 28218, 0.4408], [28205, 28219, 0.4481], [28205, 28220, 0.3875], [28205, 28221, 0.4177], [28205, 28222, 0.4096], [28205, 28223, 0.63], [28205, 28224, 0.3798], [28205, 28225, 0.4177], [28206, 28207, 0.4408], [28206, 28208, 0.6512], [28206, 28209, 0.3128], [28206, 28210, 0.3088], [28206, 28211, 0.2932], [28206, 28212, 0.4962], [28206, 28213, 0.403], [28206, 28214, 0.4559], [28206, 28215, 0.4166], [28206, 28217, 0.8116], [28206, 28218, 0.5921], [28206, 28219, 0.5978], [28206, 28220, 0.2847], [28206, 28221, 0.4823], [28206, 28222, 0.328], [28206, 28223, 0.3957], [28206, 28224, 0.3054], [28206, 28225, 0.4823], [28207, 28208, 0.5126], [28207, 28209, 0.2055], [28207, 28210, 0.5323], [28207, 28211, 0.6311], [28207, 28212, 0.4441], [28207, 28213, 0.4248], [28207, 28214, 0.3751], [28207, 28215, 0.5328], [28207, 28217, 0.5126], [28207, 28218, 0.4096], [28207, 28219, 0.3784], [28207, 28220, 0.3557], [28207, 28221, 0.5246], [28207, 28222, 0.4181], [28207, 28223, 0.6061], [28207, 28224, 0.3853], [28207, 28225, 0.5246], [28208, 28209, 0.3603], [28208, 28210, 0.4333], [28208, 28211, 0.3784], [28208, 28212, 0.5266], [28208, 28213, 0.46], [28208, 28214, 0.3778], [28208, 28215, 0.5209], [28208, 28217, 0.7475], [28208, 28218, 0.5333], [28208, 28219, 0.5862], [28208, 28220, 0.328], [28208, 28221, 0.6124], [28208, 28222, 0.3449], [28208, 28223, 0.4553], [28208, 28224, 0.3875], [28208, 28225, 0.6124], [28209, 28210, 0.2133], [28209, 28211, 0.1975], [28209, 28212, 0.3045], [28209, 28213, 0.1656], [28209, 28214, 0.1849], [28209, 28215, 0.2048], [28209, 28217, 0.328], [28209, 28218, 0.4173], [28209, 28219, 0.5531], [28209, 28220, 0.1572], [28209, 28221, 0.3936], [28209, 28222, 0.1828], [28209, 28223, 0.1904], [28209, 28224, 0.1902], [28209, 28225, 0.3936], [28210, 28211, 0.8403], [28210, 28212, 0.4096], [28210, 28213, 0.328], [28210, 28214, 0.2657], [28210, 28215, 0.372], [28210, 28217, 0.3244], [28210, 28218, 0.5054], [28210, 28219, 0.3865], [28210, 28220, 0.5328], [28210, 28221, 0.4823], [28210, 28222, 0.4707], [28210, 28223, 0.4256], [28210, 28224, 0.4784], [28210, 28225, 0.4823], [28211, 28212, 0.4823], [28211, 28213, 0.3449], [28211, 28214, 0.3054], [28211, 28215, 0.3936], [28211, 28217, 0.342], [28211, 28218, 0.4013], [28211, 28219, 0.3702], [28211, 28220, 0.4707], [28211, 28221, 0.5718], [28211, 28222, 0.5551], [28211, 28223, 0.4096], [28211, 28224, 0.5624], [28211, 28225, 0.5718], [28212, 28213, 0.3355], [28212, 28214, 0.3272], [28212, 28215, 0.4173], [28212, 28217, 0.4823], [28212, 28218, 0.6674], [28212, 28219, 0.5197], [28212, 28220, 0.372], [28212, 28221, 0.7767], [28212, 28222, 0.4345], [28212, 28223, 0.3944], [28212, 28224, 0.4017], [28212, 28225, 0.7767], [28213, 28214, 0.379], [28213, 28215, 0.7552], [28213, 28217, 0.46], [28213, 28218, 0.3429], [28213, 28219, 0.32], [28213, 28220, 0.4691], [28213, 28221, 0.3203], [28213, 28222, 0.5398], [28213, 28223, 0.3823], [28213, 28224, 0.5921], [28213, 28225, 0.3203], [28214, 28215, 0.3593], [28214, 28217, 0.4434], [28214, 28218, 0.3642], [28214, 28219, 0.313], [28214, 28220, 0.2707], [28214, 28221, 0.3128], [28214, 28222, 0.2821], [28214, 28223, 0.403], [28214, 28224, 0.2892], [28214, 28225, 0.3128], [28215, 28217, 0.4788], [28215, 28218, 0.3875], [28215, 28219, 0.3603], [28215, 28220, 0.5801], [28215, 28221, 0.3639], [28215, 28222, 0.6728], [28215, 28223, 0.4322], [28215, 28224, 0.735], [28215, 28225, 0.3639], [28217, 28218, 0.4893], [28217, 28219, 0.5862], [28217, 28220, 0.2978], [28217, 28221, 0.5608], [28217, 28222, 0.3449], [28217, 28223, 0.417], [28217, 28224, 0.3527], [28217, 28225, 0.5608], [28218, 28219, 0.678], [28218, 28220, 0.3449], [28218, 28221, 0.7164], [28218, 28222, 0.3639], [28218, 28223, 0.4021], [28218, 28224, 0.372], [28218, 28225, 0.7164], [28219, 28220, 0.2902], [28219, 28221, 0.6618], [28219, 28222, 0.337], [28219, 28223, 0.3401], [28219, 28224, 0.3449], [28219, 28225, 0.6618], [28220, 28221, 0.3206], [28220, 28222, 0.8548], [28220, 28223, 0.3875], [28220, 28224, 0.7921], [28220, 28225, 0.3206], [28221, 28222, 0.3768], [28221, 28223, 0.46], [28221, 28224, 0.3473], [28221, 28225, 1.0], [28222, 28223, 0.4096], [28222, 28224, 0.9238], [28222, 28225, 0.3768], [28223, 28224, 0.3798], [28223, 28225, 0.46], [28224, 28225, 0.3473]], "D": [[28202, 28203, 0.4021], [28202, 28204, 0.3476], [28202, 28205, 0.4553], [28202, 28209, 0.2204], [28202, 28211, 0.3244], [28202, 28212, 0.3736], [28202, 28214, 0.3411], [28202, 28218, 0.2721], [28202, 28219, 0.4027], [28202, 28220, 0.4021], [28202, 28221, 0.3885], [28202, 28222, 0.4719], [28202, 28225, 0.3164], [28203, 28204, 0.8465], [28203, 28205, 0.4013], [28203, 28209, 0.5791], [28203, 28211, 0.695], [28203, 28212, 0.9192], [28203, 28214, 0.3203], [28203, 28218, 0.5246], [28203, 28219, 0.3164], [28203, 28220, 1.0], [28203, 28221, 0.4979], [28203, 28222, 0.3768], [28203, 28225, 0.593], [28204, 28205, 0.342], [28204, 28209, 0.4902], [28204, 28211, 0.5862], [28204, 28212, 0.8493], [28204, 28214, 0.3355], [28204, 28218, 0.4441], [28204, 28219, 0.2721], [28204, 28220, 0.8465], [28204, 28221, 0.4676], [28204, 28222, 0.3206], [28204, 28225, 0.5054], [28205, 28209, 0.2057], [28205, 28211, 0.4358], [28205, 28212, 0.3702], [28205, 28214, 0.4394], [28205, 28218, 0.3251], [28205, 28219, 0.4408], [28205, 28220, 0.4013], [28205, 28221, 0.4676], [28205, 28222, 0.5763], [28205, 28225, 0.46], [28209, 28211, 0.3751], [28209, 28212, 0.5323], [28209, 28214, 0.1701], [28209, 28218, 0.2739], [28209, 28219, 0.1622], [28209, 28220, 0.5791], [28209, 28221, 0.2687], [28209, 28222, 0.1895], [28209, 28225, 0.3251], [28211, 28212, 0.6377], [28211, 28214, 0.2545], [28211, 28218, 0.6311], [28211, 28219, 0.342], [28211, 28220, 0.695], [28211, 28221, 0.4441], [28211, 28222, 0.4544], [28211, 28225, 0.4823], [28212, 28214, 0.2978], [28212, 28218, 0.4823], [28212, 28219, 0.2932], [28212, 28220, 0.9192], [28212, 28221, 0.46], [28212, 28222, 0.3473], [28212, 28225, 0.547], [28214, 28218, 0.2902], [28214, 28219, 0.2255], [28214, 28220, 0.3203], [28214, 28221, 0.4464], [28214, 28222, 0.3811], [28214, 28225, 0.3678], [28218, 28219, 0.2563], [28218, 28220, 0.5246], [28218, 28221, 0.3336], [28218, 28222, 0.3768], [28218, 28225, 0.4013], [28219, 28220, 0.3164], [28219, 28221, 0.4481], [28219, 28222, 0.4173], [28219, 28225, 0.4021], [28220, 28221, 0.4979], [28220, 28222, 0.3768], [28220, 28225, 0.593], [28221, 28222, 0.4017], [28221, 28225, 0.726], [28222, 28225, 0.3936]], "E": [[28202, 28203, 0.3928], [28202, 28206, 0.8521], [28202, 28209, 0.3251], [28202, 28212, 0.7113], [28202, 28214, 0.5333], [28202, 28219, 0.7113], [28202, 28220, 0.4264], [28202, 28222, 0.5107], [28202, 28225, 0.7113], [28203, 28206, 0.3531], [28203, 28209, 0.2342], [28203, 28212, 0.5718], [28203, 28214, 0.3865], [28203, 28219, 0.5718], [28203, 28220, 0.7312], [28203, 28222, 0.4865], [28203, 28225, 0.5718], [28206, 28209, 0.4013], [28206, 28212, 0.593], [28206, 28214, 0.4893], [28206, 28219, 0.593], [28206, 28220, 0.4264], [28206, 28222, 0.6179], [28206, 28225, 0.593], [28209, 28212, 0.4741], [28209, 28214, 0.1694], [28209, 28219, 0.4741], [28209, 28220, 0.2625], [28209, 28222, 0.4948], [28209, 28225, 0.4741], [28212, 28214, 0.3581], [28212, 28219, 1.0], [28212, 28220, 0.4544], [28212, 28222, 0.7312], [28212, 28225, 1.0], [28214, 28219, 0.3581], [28214, 28220, 0.4173], [28214, 28222, 0.2745], [28214, 28225, 0.3581], [28219, 28220, 0.4544], [28219, 28222, 0.7312], [28219, 28225, 1.0], [28220, 28222, 0.5246], [28220, 28225, 0.4544], [28222, 28225, 0.7312]], "F": [[28209, 28214, 0.0], [28209, 28222, 0.1349], [28214, 28222, 0.0]], "G": [[28203, 28209, 0.1133], [28203, 28210, 0.1535], [28203, 28213, 0.2241], [28203, 28214, 0.2543], [28203, 28220, 0.313], [28203, 28222, 0.0968], [28209, 28210, 0.275], [28209, 28213, 0.2279], [28209, 28214, 0.1975], [28209, 28220, 0.1975], [28209, 28222, 0.1802], [28210, 28213, 0.683], [28210, 28214, 0.3411], [28210, 28220, 0.2721], [28210, 28222, 0.2161], [28213, 28214, 0.32], [28213, 28220, 0.3784], [28213, 28222, 0.1324], [28214, 28220, 0.2342], [28214, 28222, 0.1919], [28220, 28222, 0.1268]]}}`);
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return await response.json();
        } catch (error) {
            console.error('There was a problem with the fetch operation:', error);
        }
    }

    function extractAndFormatNumbers(str) {
        const matches = str.match(/\d+/g);
        if (!matches) return [];

        return matches.map(num => {
            return String(num).padStart(6, '0');
        });
    }

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function () {
            console.log('Text successfully copied to clipboard');
        }).catch(function (err) {
            console.error('Could not copy text to clipboard: ', err);
        });
    }

    function meanOfArray(arr) {
        if (arr.length === 0) return 0;
        const sum = arr.reduce((acc, val) => acc + val, 0);
        return sum / arr.length;
    }

    async function pushOneReport(contest, root) {
        const {problems, scores, students} = await fetchJsonFromUrl(`${URL_PREFIX}${contest}.json`);

        const studentEntries = Object.entries(students);
        const studentIdToCol = new Map();

        studentEntries.forEach(([studentId, name], index) => {
            studentIdToCol.set(+studentId, index);
        });
        const numStudents = studentIdToCol.size;

        // Создаём таблицы с данными. По размеру она |students|×|students|
        problems[MEAN] = MEAN;
        const matrices = new Map();
        const orderedProblems = [MEAN];
        Object.entries(problems).forEach(([probId, title], index) => {
            matrices.set(probId, Array.from({length: numStudents}, () => Array(numStudents).fill(0)));
            orderedProblems.push(probId);
        });
        matrices.set(MEAN, Array.from({length: numStudents}, () => Array(numStudents).fill(0).map((el) => [])));
        const meanMatrix = matrices.get(MEAN);
        Object.entries(scores).forEach(([probId, probScores], index) => {
            const curMatrix = matrices.get(probId);
            for (const [student1, student2, score] of probScores) {
                const col1 = studentIdToCol.get(student1);
                const col2 = studentIdToCol.get(student2);
                curMatrix[col1][col2] = score;
                curMatrix[col2][col1] = score;
                meanMatrix[col1][col2].push(score);
                meanMatrix[col2][col1].push(score);
            }
        });
        for (const row of meanMatrix) {
            for (let col = 0; col < row.length; col++) {
                row[col] = meanOfArray(row[col]);
            }
        }
        let html = `<hr><h1>${contest}</h1>`;
        const colorer = chroma.scale(['#f7fcb9', '#addd8e', '#f00']).domain([0, 60, 100]);
        for (const probId of orderedProblems) {
            html += `<h2><a id="${contest}-${probId}" href="#${contest}-${probId}">${contest} — ${probId}</a></h2><table>`;
            html += '<tr><td></td>';
            studentEntries.forEach(([studentId, name], index) => {
                html += `<th class="nm"><p class="vt">${name}</p></th>`
            });
            html += '</tr>';
            const curMatrix = matrices.get(probId);
            for (let rowInd = 0; rowInd < curMatrix.length; rowInd++) {
                const row = curMatrix[rowInd];
                html += '<tr>';
                html += `<th class="nm nmh">${studentEntries[rowInd][1]}</th>`;
                for (let colInd = 0; colInd < row.length; colInd++) {
                    let cell = row[colInd];
                    cell = Math.round(cell * 100);
                    html += `<td title="(uid==${studentEntries[rowInd][0]} or uid==${studentEntries[colInd][0]}) and prob==&quot;${probId}&quot;" style="background-color: ${colorer(cell).hex()}">${cell > 0 ? cell : ''}</td>`;
                }
                html += '</tr>';
            }
            html += '</table><hr>';
        }
        let div = document.createElement("div");
        div.className = 'report';
        div.innerHTML = html;
        for (const td of div.getElementsByTagName('td')) {
            td.addEventListener("click", () => copyToClipboard(td.title));
        }
        root.appendChild(div);
    }


    async function reportContent() {
        const value = reportList.value;
        updateURLParameter(CONTESTS_PARM, value);
        const contests = extractAndFormatNumbers(value);
        root.innerHTML = '';
        for (let contest of contests) {
            try {
                await pushOneReport(contest, root);
            } catch (e) {
                console.error(e);
            }
        }
    }


    async function run() {
        root = document.getElementById('report');
        reportList = document.getElementById('reportList');
        reportGenButton = document.getElementById('reportGen');
        reportList.value = getParameterByName(CONTESTS_PARM) || '';
        reportGenButton.onclick = reportContent;
    }

    function init() {
        loadScript(
                'https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js',
                'sha512-zInFF17qBFVvvvFpIfeBzo7Tj7+rQxLeTJDmbxjBz5/zIr89YVbTNelNhdTT+/DCrxoVzBeUPVFJsczKbB7sew==',
        ).then(run);
    }

    init();
</script>
</body>
</html>
